pipeline {
    agent any
	
	tools {
			nodejs 'nodejs 16.16.0'
		}

    stages {
        stage('Run Newman API Tests') {
            steps {
                script {
                sh '''
				node --version
                newman --version
                npm install -g newman-reporter-allure
                rm -rf allure-results
				newman run collection.json --insecure -r allure --reporter-allure-export allure-results
				'''
                }
            }
        }
    }
}

	stage('reports') {
    steps {
    script {
            allure([
                    includeProperties: false,
                    jdk: '',
                    properties: [],
                    reportBuildPolicy: 'ALWAYS',
                    results: [[path: 'target/allure-results']]
            ])
    }
    }
}