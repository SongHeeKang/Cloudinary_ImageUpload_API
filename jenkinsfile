pipeline {
    agent any

    stages {
        stage('Run Newman API Tests') {
            steps {
                script {
                    // Run Newman script with environment file
                    runNewmanTests()
                }
            }
        }
    }
}

def runNewmanTests() {
    def nodeInstalled = sh(script: 'node --version', returnStatus: true) == 0
    sh '''
        newman --version
        npm install -g newman-reporter-allure
        rm -rf allure-results
        newman run collection.json --insecure -r allure --reporter-allure-export allure-results
    '''
}